#!/bin/bash
# CX Linux live-build auto/config
# This script is called by lb config to set build parameters
# Copyright 2025 AI Venture Holdings LLC
# SPDX-License-Identifier: Apache-2.0

set -e

# CX Linux build configuration
# Using Ubuntu 24.04 LTS (noble) for latest hardware support and AI compatibility
CODENAME="noble"
ARCH="amd64"
VERSION="0.1.0"

# Ubuntu 24.04 LTS live-build configuration
lb config noauto \
    --distribution "${CODENAME}" \
    --parent-distribution "${CODENAME}" \
    --parent-debian-installer-distribution "${CODENAME}" \
    --parent-mirror-bootstrap "http://archive.ubuntu.com/ubuntu/" \
    --parent-mirror-chroot-security "http://security.ubuntu.com/ubuntu/" \
    --parent-mirror-binary "http://archive.ubuntu.com/ubuntu/" \
    --parent-mirror-binary-security "http://security.ubuntu.com/ubuntu/" \
    --archive-areas "main restricted universe multiverse" \
    --architectures "${ARCH}" \
    --binary-images iso-hybrid \
    --debian-installer-distribution "${CODENAME}" \
    --debian-installer live \
    --debian-installer-gui false \
    --iso-application "CX Linux" \
    --iso-preparer "CX Linux Build System" \
    --iso-publisher "AI Venture Holdings LLC; https://cxlinux.ai" \
    --iso-volume "CX Linux ${VERSION}" \
    --memtest none \
    --security true \
    --backports true \
    --apt-indices true \
    --apt-recommends true \
    --apt-source-archives false \
    --cache true \
    --cache-indices true \
    --cache-packages true \
    --checksums sha256 \
    --chroot-filesystem squashfs \
    --clean \
    --compression xz \
    --debconf-frontend noninteractive \
    --debconf-priority critical \
    --firmware-binary true \
    --firmware-chroot true \
    --hdd-size auto \
    --initramfs live-boot \
    --initsystem systemd \
    --interactive false \
    --linux-flavours "${ARCH}" \
    --linux-packages "linux-image linux-headers" \
    --mode debian \
    --system live \
    --bootappend-live "boot=live components quiet splash locales=en_US.UTF-8 keyboard-layouts=us" \
    "${@}"

# Create package lists directory
mkdir -p config/package-lists
echo "apt-transport-https ca-certificates gnupg software-properties-common ubuntu-keyring" > config/package-lists/base.list.chroot

echo "CX Linux live-build configured successfully"
