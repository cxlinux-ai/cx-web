[Unit]
Description=Gunicorn daemon for {{ name }}
Requires={{ name }}.socket
After=network.target{% if database %} {{ database }}.service{% endif %}

[Service]
Type=notify
User={{ user | default('www-data') }}
Group={{ group | default('www-data') }}
RuntimeDirectory=gunicorn
WorkingDirectory={{ working_dir }}
{% if env_file %}
EnvironmentFile={{ env_file }}
{% endif %}
{% for key, value in environment.items() %}
Environment="{{ key }}={{ value }}"
{% endfor %}
ExecStart={{ venv_path }}/bin/gunicorn \
    --workers {{ workers | default(4) }} \
    --bind unix:/run/gunicorn/{{ name }}.sock \
    --access-logfile {{ log_dir | default('/var/log/gunicorn') }}/{{ name }}_access.log \
    --error-logfile {{ log_dir | default('/var/log/gunicorn') }}/{{ name }}_error.log \
    {{ wsgi_app }}
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
