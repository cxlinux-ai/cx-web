---
sidebar_position: 5
title: Rollback & Recovery
description: Undo changes and recover from issues. CX Linux tracks all modifications for easy rollback.
keywords: [rollback, recovery, undo, backup, restore, snapshots]
---

# Rollback & Recovery

CX Linux automatically tracks changes, making it easy to undo modifications and recover from issues. Every operation creates a recovery point.

## Understanding Snapshots

### What Gets Tracked

CX Linux creates snapshots before:

- Package installations and removals
- System configuration changes
- Service modifications
- User and permission changes
- File modifications

### Snapshot Contents

Each snapshot includes:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snapshot: 2024-01-15_14:30:22_nginx-install                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦ Packages: nginx (1.24.0) - installed                    â”‚
â”‚ ğŸ“„ Files: /etc/nginx/nginx.conf - created                  â”‚
â”‚ âš™ï¸  Services: nginx.service - enabled, started             â”‚
â”‚ ğŸ”¥ Firewall: port 80 - opened                              â”‚
â”‚ ğŸ’¾ Size: 2.3 KB                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Quick Rollback

### Undo Last Change

```bash
# Undo the most recent operation
cx rollback

# Confirm before rollback
cx rollback --confirm
```

### Undo Specific Operation

```bash
# List recent operations
cx history

# Output:
# [1] 2024-01-15 14:30 - Installed nginx
# [2] 2024-01-15 14:15 - Updated system packages
# [3] 2024-01-15 13:45 - Added user deploy

# Rollback specific operation
cx rollback 1

# Or by description
cx rollback "nginx installation"
```

## Viewing History

### Operation History

```bash
# Recent operations
cx history

# Detailed view
cx history --verbose

# Filter by type
cx history --type packages
cx history --type config
cx history --type services

# Filter by date
cx history --since "2024-01-01"
cx history --today
```

### Snapshot Details

```bash
# View specific snapshot
cx snapshot show 1

# Output:
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Snapshot #1: nginx-install
# Created: 2024-01-15 14:30:22
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Command: cx "install nginx and enable it"
#
# Changes:
# â”œâ”€ Package installed: nginx 1.24.0
# â”œâ”€ Config created: /etc/nginx/nginx.conf
# â”œâ”€ Config created: /etc/nginx/sites-enabled/default
# â”œâ”€ Service enabled: nginx
# â”œâ”€ Service started: nginx
# â””â”€ Firewall: allowed port 80/tcp
#
# Rollback command: cx rollback 1
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Selective Rollback

### Choose What to Undo

```bash
# Rollback only package changes
cx rollback 1 --only packages

# Rollback only configuration
cx rollback 1 --only config

# Rollback everything except firewall
cx rollback 1 --except firewall
```

### Partial Recovery

```bash
# Restore just one file
cx restore /etc/nginx/nginx.conf

# Restore files from specific snapshot
cx restore /etc/nginx/ --from snapshot-1

# Restore service state
cx restore service nginx --from snapshot-1
```

## Configuration File Recovery

### View File History

```bash
# See all versions of a config
cx file-history /etc/nginx/nginx.conf

# Output:
# /etc/nginx/nginx.conf
# â”œâ”€ Current (modified 2024-01-15 16:00)
# â”œâ”€ Snapshot #3 (2024-01-15 15:30) - performance tuning
# â”œâ”€ Snapshot #1 (2024-01-15 14:30) - initial install
# â””â”€ Package default
```

### Restore File Version

```bash
# Restore from snapshot
cx restore /etc/nginx/nginx.conf --from snapshot-1

# Restore to package default
cx restore /etc/nginx/nginx.conf --default

# View diff before restore
cx diff /etc/nginx/nginx.conf --from snapshot-1
```

### Compare Versions

```bash
# Diff current vs snapshot
cx diff /etc/nginx/nginx.conf snapshot-1

# Diff two snapshots
cx diff /etc/nginx/nginx.conf snapshot-1 snapshot-3
```

## Package Recovery

### Undo Package Changes

```bash
# Remove recently installed package and deps
cx rollback "nginx installation"

# Reinstall removed package
cx rollback "nginx removal"

# Downgrade to previous version
cx rollback "nodejs upgrade"
```

### Package History

```bash
# View package history
cx package-history nginx

# Output:
# nginx version history:
# â”œâ”€ 1.24.0 - current (installed 2024-01-15)
# â”œâ”€ 1.22.1 - previous (2023-06-01 - 2024-01-15)
# â””â”€ 1.18.0 - earlier (2023-01-15 - 2023-06-01)

# Restore specific version
cx restore nginx --version 1.22.1
```

## Service Recovery

### Restore Service State

```bash
# View service history
cx service-history nginx

# Restore previous state
cx restore service nginx --from snapshot-1

# Reset to default configuration
cx service reset nginx
```

### Recover Failed Services

```bash
# Diagnose service failure
cx diagnose nginx

# Auto-repair common issues
cx repair nginx

# Rollback to last working state
cx rollback --to-working nginx
```

## System Recovery

### Create Manual Snapshot

```bash
# Before major changes
cx snapshot create "before-kubernetes-install"

# With description
cx snapshot create "pre-upgrade" --note "System state before dist-upgrade"
```

### List All Snapshots

```bash
# All snapshots
cx snapshot list

# With details
cx snapshot list --verbose

# Filter
cx snapshot list --since "1 week ago"
```

### Restore Full Snapshot

```bash
# Preview what would be restored
cx restore --from "before-kubernetes-install" --dry-run

# Perform full restore
cx restore --from "before-kubernetes-install"
```

## Emergency Recovery

### Recovery Mode

If CX Linux itself is affected:

```bash
# Direct command execution
cx-recover

# This provides:
# 1. List of all snapshots
# 2. Direct restore commands
# 3. Manual recovery instructions
```

### Without CX Linux

If CX Linux isn't available:

```bash
# Snapshots are stored in plain text
ls ~/.cx/snapshots/

# Each snapshot contains:
# - manifest.json (what changed)
# - files/ (backed up files)
# - packages.txt (package states)

# Manual restore example
cp ~/.cx/snapshots/snapshot-1/files/etc/nginx/nginx.conf /etc/nginx/
```

## Snapshot Management

### Storage Usage

```bash
# View snapshot storage
cx snapshot storage

# Output:
# Snapshot storage: /home/user/.cx/snapshots
# Total size: 156 MB
# Snapshots: 45
# Oldest: 2023-12-01
# Newest: 2024-01-15
```

### Cleanup Old Snapshots

```bash
# Remove old snapshots
cx snapshot cleanup --older-than "30 days"

# Keep only last N snapshots
cx snapshot cleanup --keep-last 20

# Interactive cleanup
cx snapshot cleanup --interactive
```

### Export/Import

```bash
# Export snapshot for backup
cx snapshot export snapshot-1 -o snapshot-backup.tar.gz

# Import on another system
cx snapshot import snapshot-backup.tar.gz
```

## Rollback Best Practices

### 1. Create Snapshots Before Major Changes

```bash
cx snapshot create "pre-upgrade-2024-01"
cx "upgrade all packages"
```

### 2. Test Rollback Capability

```bash
# Verify you can rollback
cx rollback --dry-run "recent change"
```

### 3. Keep Critical Snapshots

```bash
# Mark important snapshots
cx snapshot keep "working-production-state"

# Won't be auto-cleaned
```

### 4. Regular Snapshot Cleanup

```bash
# Add to cron or timer
cx snapshot cleanup --older-than "60 days" --keep-marked
```

## Troubleshooting

### Rollback Failed

```bash
# Check what went wrong
cx rollback-status

# Retry with force
cx rollback 1 --force

# Manual intervention
cx rollback 1 --step-by-step
```

### Snapshot Corrupted

```bash
# Verify snapshot integrity
cx snapshot verify snapshot-1

# Repair if possible
cx snapshot repair snapshot-1

# Remove corrupted snapshot
cx snapshot remove snapshot-1 --force
```

### Partial Rollback

If rollback partially completed:

```bash
# Check current state
cx status

# Continue rollback
cx rollback --continue

# Or abort and cleanup
cx rollback --abort
```

## Related Documentation

- [Configuration](/docs/getting-started/configuration) - Snapshot settings
- [CLI Commands](/docs/reference/cli-commands) - Full rollback command reference
- [Dry-Run Mode](/docs/user-guide/dry-run-mode) - Preview before changes
